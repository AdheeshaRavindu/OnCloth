<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' https: data:; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    <meta name="description" content="Review your shopping cart and proceed to checkout.">
    
    <title>Shopping Cart - OnCloth</title>
    
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="shop.html" class="logo">OnCloth</a>
                <nav class="nav">
                    <a href="shop.html" class="nav-link">Shop</a>
                    <a href="shipping.html" class="nav-link">Shipping</a>
                    <a href="cart.html" class="nav-link cart-icon">
                        Cart
                        <span id="cart-count" class="cart-count">0</span>
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <h1 style="margin-top: 2rem; margin-bottom: 1rem;">Shopping Cart</h1>
        
        <!-- Messages -->
        <div id="error-message" class="message message-error"></div>
        <div id="success-message" class="message message-success"></div>
        
        <!-- Cart Items -->
        <div id="cart-items" class="cart-items">
            <!-- Loaded by JavaScript -->
        </div>
        
        <!-- Empty Cart Message -->
        <div id="empty-cart" class="cart-empty" style="display: none;">
            <h2>Your cart is empty</h2>
            <p style="margin: 1rem 0; color: var(--text-secondary);">Add some hoodies to get started!</p>
            <a href="shop.html" class="btn btn-primary">Continue Shopping</a>
        </div>
        
        <!-- Cart Summary -->
        <div id="cart-summary" class="cart-summary" style="display: none;">
            <div class="summary-row">
                <span>Subtotal:</span>
                <span id="subtotal">$0.00</span>
            </div>
            <div class="summary-row">
                <span>Shipping:</span>
                <span>Calculated at checkout</span>
            </div>
            <div class="summary-row">
                <span>Total:</span>
                <span id="total">$0.00</span>
            </div>
            <a href="checkout.html" class="btn btn-primary btn-full" style="margin-top: 1rem;">Proceed to Checkout</a>
            <a href="shop.html" class="btn btn-outline btn-full" style="margin-top: 0.5rem;">Continue Shopping</a>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Shop</h4>
                    <ul class="footer-links">
                        <li><a href="shop.html">All Hoodies</a></li>
                        <li><a href="size-guide.html">Size Guide</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Customer Service</h4>
                    <ul class="footer-links">
                        <li><a href="shipping.html">Shipping Info</a></li>
                        <li><a href="returns.html">Returns & Exchanges</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul class="footer-links">
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="terms.html">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <p>Email: support@oncloth.shop</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 OnCloth. All rights reserved. • Created with ❤️ Adheesha</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="js/security.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/products.js"></script>
    <script src="js/cart.js"></script>
    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            Utils.updateCartBadge();
            renderCart();
        });

        function renderCart() {
            const cart = Cart.getCart();
            const container = document.getElementById('cart-items');
            const emptyMessage = document.getElementById('empty-cart');
            const summarySection = document.getElementById('cart-summary');
            
            if (cart.length === 0) {
                container.style.display = 'none';
                summarySection.style.display = 'none';
                emptyMessage.style.display = 'block';
                return;
            }
            
            emptyMessage.style.display = 'none';
            container.style.display = 'block';
            summarySection.style.display = 'block';
            
            container.innerHTML = '';
            
            cart.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'cart-item';
                itemElement.innerHTML = `
                    <img src="${Security.sanitizeHTML(item.image)}" 
                         alt="${Security.sanitizeHTML(item.name)}" 
                         class="cart-item-image"
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'100\\' height=\\'100\\'%3E%3Crect fill=\\'%23f5f5f5\\' width=\\'100\\' height=\\'100\\'/%3E%3C/svg%3E'">
                    
                    <div class="cart-item-details">
                        <h3>${Security.sanitizeHTML(item.name)}</h3>
                        <p class="cart-item-variant">
                            Size: ${Security.sanitizeHTML(item.size)} | 
                            Color: ${Security.sanitizeHTML(item.color)}
                        </p>
                        <p class="cart-item-price">${Utils.formatPrice(item.price)}</p>
                        
                        <div class="quantity-selector" style="margin-top: 0.5rem;">
                            <button type="button" class="quantity-btn" onclick="updateQuantity(${index}, ${item.quantity - 1})">-</button>
                            <input type="number" class="quantity-input" value="${item.quantity}" min="1" max="5" readonly>
                            <button type="button" class="quantity-btn" onclick="updateQuantity(${index}, ${item.quantity + 1})">+</button>
                        </div>
                    </div>
                    
                    <div class="cart-item-actions">
                        <p style="font-size: 1.25rem; font-weight: 700;">
                            ${Utils.formatPrice(item.price * item.quantity)}
                        </p>
                        <button type="button" class="remove-btn" onclick="removeItem(${index})">Remove</button>
                    </div>
                `;
                container.appendChild(itemElement);
            });
            
            // Update summary
            updateSummary();
        }

        function updateSummary() {
            const subtotal = Cart.getSubtotal();
            document.getElementById('subtotal').textContent = Utils.formatPrice(subtotal);
            document.getElementById('total').textContent = Utils.formatPrice(subtotal);
        }

        function updateQuantity(index, newQuantity) {
            Utils.hideError('error-message');
            Utils.hideError('success-message');
            
            if (newQuantity < 1 || newQuantity > 5) {
                return;
            }
            
            if (Cart.updateQuantity(index, newQuantity)) {
                renderCart();
                Utils.showSuccess('success-message', 'Quantity updated');
                setTimeout(() => Utils.hideError('success-message'), 2000);
            } else {
                Utils.showError('error-message', 'Failed to update quantity');
            }
        }

        function removeItem(index) {
            Utils.hideError('error-message');
            Utils.hideError('success-message');
            
            if (confirm('Remove this item from cart?')) {
                if (Cart.removeItem(index)) {
                    renderCart();
                    Utils.showSuccess('success-message', 'Item removed from cart');
                    setTimeout(() => Utils.hideError('success-message'), 2000);
                } else {
                    Utils.showError('error-message', 'Failed to remove item');
                }
            }
        }
    </script>
</body>
</html>
