<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' https: data:; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    <meta name="description" content="Order confirmation and payment success.">
    
    <title>Order Success - OnCloth</title>
    
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="shop.html" class="logo">OnCloth</a>
                <nav class="nav">
                    <a href="shop.html" class="nav-link">Shop</a>
                    <a href="shipping.html" class="nav-link">Shipping</a>
                    <a href="cart.html" class="nav-link cart-icon">
                        Cart
                        <span id="cart-count" class="cart-count">0</span>
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <div style="max-width: 600px; margin: 4rem auto; text-align: center;">
            <div style="width: 80px; height: 80px; background-color: var(--success-color); border-radius: 50%; margin: 0 auto 2rem; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: white;">
                ✓
            </div>
            
            <h1 style="color: var(--success-color); margin-bottom: 1rem;">Order Confirmed!</h1>
            
            <p style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 2rem;">
                Thank you for your purchase. Your order has been received and is being processed.
            </p>
            
            <div id="order-details" style="background-color: #f9f9f9; padding: 2rem; border-radius: var(--border-radius); margin-bottom: 2rem; text-align: left;">
                <h2 style="margin-bottom: 1rem;">Order Details</h2>
                <div id="order-info">
                    <!-- Loaded by JavaScript -->
                </div>
            </div>
            
            <div style="background-color: #e3f2fd; padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 2rem;">
                <h3 style="margin-bottom: 0.5rem;">What's Next?</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                    <strong>Payment received.</strong> You'll get shipping details by email.
                </p>
                <p style="color: var(--text-secondary);">
                    Once your order ships, we'll send you a tracking number so you can follow your package.
                </p>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <a href="shop.html" class="btn btn-primary">Continue Shopping</a>
                <a href="shop.html" class="btn btn-outline">Back to Home</a>
            </div>
            
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 2rem;">
                Questions about your order? Contact us at <strong>orders@oncloth.shop</strong>
            </p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Shop</h4>
                    <ul class="footer-links">
                        <li><a href="shop.html">All Hoodies</a></li>
                        <li><a href="size-guide.html">Size Guide</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Customer Service</h4>
                    <ul class="footer-links">
                        <li><a href="shipping.html">Shipping Info</a></li>
                        <li><a href="returns.html">Returns & Exchanges</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul class="footer-links">
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="terms.html">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <p>Email: support@oncloth.shop</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 OnCloth. All rights reserved. • Created with ❤️ Adheesha</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="js/security.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/products.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/checkout.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            Utils.updateCartBadge();
            
            // Read lastOrder from localStorage
            let order = null;
            try {
                const orderData = localStorage.getItem('lastOrder');
                if (orderData) {
                    order = JSON.parse(orderData);
                }
            } catch (e) {
                console.error('Error reading order:', e);
            }
            
            if (order) {
                displayOrderDetails(order);
                
                // Clear cart ONLY after success page loads
                Cart.clearCart();
                
                // Clear lastOrder from localStorage
                localStorage.removeItem('lastOrder');
                
                Utils.updateCartBadge();
            } else {
                // Show generic success message if no order details
                document.getElementById('order-info').innerHTML = '<p>Your order has been received.</p>';
            }
        });

        function displayOrderDetails(order) {
            const container = document.getElementById('order-info');
            
            let itemsHTML = '<ul style="list-style: none; padding: 0;">';
            order.items.forEach(item => {
                itemsHTML += `
                    <li style="padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                        <strong>${Security.sanitizeHTML(item.name)}</strong><br>
                        <small style="color: var(--text-secondary);">
                            ${Security.sanitizeHTML(item.size)} / ${Security.sanitizeHTML(item.color)} × ${item.quantity} - 
                            ${Utils.formatPrice(item.price * item.quantity)}
                        </small>
                    </li>
                `;
            });
            itemsHTML += '</ul>';
            
            container.innerHTML = `
                <p><strong>Order ID:</strong> ${Security.sanitizeHTML(order.id)}</p>
                <p><strong>Date:</strong> ${Utils.formatDate(order.date)}</p>
                <p><strong>Email:</strong> ${Security.sanitizeHTML(order.customer.email)}</p>
                <hr style="margin: 1rem 0; border: none; border-top: 1px solid var(--border-color);">
                ${itemsHTML}
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--border-color);">
                    <p style="display: flex; justify-content: space-between;">
                        <span>Subtotal:</span>
                        <span>${Utils.formatPrice(order.subtotal)}</span>
                    </p>
                    <p style="display: flex; justify-content: space-between;">
                        <span>Shipping:</span>
                        <span>${Utils.formatPrice(order.shipping)}</span>
                    </p>
                    <p style="display: flex; justify-content: space-between; font-size: 1.25rem; font-weight: 700; margin-top: 0.5rem;">
                        <span>Total:</span>
                        <span>${Utils.formatPrice(order.total)}</span>
                    </p>
                </div>
            `;
        }
    </script>
</body>
</html>
